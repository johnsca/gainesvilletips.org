<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style type="text/css">
      body {
        font-family: "Arimo",sans-serif;
      }
      #action-row {
        justify-content: space-between;
      }
      #search, #randomize {
        display: inline-block;
        color: white;
        text-align: center;
        border: 4px solid white;
        outline: 8px solid white;
        margin: 8px;
        flex-basis: 48%;
        flex-grow: 0;
        padding: 15px;
      }
      #search {
        background-color: #bb3a3b;
        outline-color: #bb3a3b;
      }
      #randomize {
        background-color: #16b7b9;
        outline-color: #16b7b9;
      }
      #search input.submit,
      #randomize input.submit
      {
        background-color: white;
        color: #16b7b9;
        font-weight: bold;
        padding: 4px 8px;
        border-radius: 4px;
        border-width: 0;
      }
      #results .no-results {
        margin-top: 1em;
      }
      #results.card-deck {
        justify-content: space-between;
      }
      #results .card {
        text-align: center;
        flex-grow: 0;
        flex-basis: 24%;
        margin: 1em 0;
      }
      #results .card-img-top img {
        height: 30vw;
        object-fit: cover;
      }
      .payment a {
        display: inline-block;
        width: 2em;
        height: 2em;
        background-size: contain;
        margin: 0.25em;
      }
      a.cash_app {
        background-image: url('https://gainesvilletips.org/wp-content/uploads/2020/03/cashapp-button.png');
      }
      a.venmo {
        background-image: url('https://gainesvilletips.org/wp-content/uploads/2020/03/venmo-button.png');
      }
      a.paypal {
        background-image: url('https://gainesvilletips.org/wp-content/uploads/2020/03/paypal-button.png');
      }
    </style>
    <script type="text/javascript">
      window.addEventListener('DOMContentLoaded', (event) => {
        var results = document.querySelector('#results');
        var template = document.querySelector('#results template');
        if(records.length == 0) {
          var no_results = document.createElement('h1');
          no_results.className = 'no-results';
          no_results.innerText = "We're sorry, but we weren't able to find who you were looking for.";
          results.appendChild(no_results);
          return;
        }
        for(var record of records) {
          var result = document.importNode(template.content, true);
          if(record.photo) {
            result.querySelector('.photo').href = record.photo;
            result.querySelector('.thumb').src = record.photo;
          } else {
            var card_img = result.querySelector('.card-img-top');
            var photo = result.querySelector('.photo');
            var thumb = result.querySelector('.thumb');
            card_img.replaceChild(thumb, photo);
            thumb.src = 'https://gainesvilletips.org/wp-content/uploads/2020/04/img-place-holder-09.png';
          }
          result.querySelector('.name').innerText = record.name;
          result.querySelector('.establishment').innerText = record.venue;
          result.querySelector('.position').innerText = record.position;
          var payment = result.querySelector('.payment');
          for(var method in payment_methods) {
            if(method in record) {
              var url = payment_methods[method](record);
              if(url) {
                var link = document.createElement('a');
                link.className = method;
                link.href = url;
                link.target = '_blank';
                payment.appendChild(link);
              }
            }
          }
          results.appendChild(result);
        }
      });
      window.addEventListener('load', (event) => {
        window.parent.postMessage({'scrollHeight': document.body.scrollHeight}, '*');
      });

      var payment_methods = {
        'cash_app': (record) => {
          if(record.cash_app) {
            return 'https://cash.app/' + record.cash_app;
          }
        },
        'venmo': (record) => {
          if(record.venmo) {
            return 'https://venmo.com/' + record.venmo.replace('@', '');
          }
        },
        'paypal': (record) => {
          if(record.paypal.startsWith('https://')) {
            return record.paypal;
          } else if (record.paypal.toLowerCase().startsWith('paypal.me/')) {
            return 'https://' + record.paypal;
          } else if (record.paypal.indexOf('@') >= 0) {
            return 'https://www.paypal.com/myaccount/transfer/homepage/external/summary?recipient=' + record.paypal;
          }
        },
      };
    </script>
  </head>
  <body>
    <div class="container-fluid">
      <div id="action-row" class="row">
        <div id="search" class="col-sm">
          <h3>A LOYAL REGULAR?</h3>
          <p>Begin your search here</p>
          <form method="GET">
            <input type="text" name="search" value="" class="search" />
            <input type="submit" value="SEARCH" class="submit" />
          </form>
        </div>
        <div id="randomize" class="col-sm">
          <h3>JUST LOVE THEM ALL?</h3>
          <p>Shuffle through all of our servers and randomize for more</p>
          <form method="GET">
            <input type="submit" value="RANDOMIZE" class="submit" />
          </form>
        </div>
      </div>
      <div id="results" class="card-deck">
        <template>
          <div class="card">
            <div class="card-img-top">
              <a class="photo" href=""><img class="thumb" width="100%" src="" /></a>
            </div>
            <div class="card-body">
              <h5 class="name card-title"></h5>
              <div class="card-text">
                <div class="position"></div>
                <div class="establishment"></div>
              </div>
            </div>
            <div class="payment card-footer"></div>
          </div>
        </template>
      </div>
    </div>
  </body>
  <script type="text/javascript">
    var records = [
      {
        "photo":     "https://gainesvilletips.org/wp-content/uploads/2020/03/scooby-doo-mystery-incorporated-standup.jpg",
        "thumbnail": "",
        "name":      "Scooby Doo",
        "email":     "scooby@example.com",
        "venue":     "The Van",
        "position":  "Cook",
        "cash_app":  "$scooby",
        "venmo":     "@scooby",
        "paypal":    "PayPal.me/scooby"
      },
      {
        "photo":     "https://gainesvilletips.org/wp-content/uploads/2020/03/Schulman-KevinHart.jpg",
        "thumbnail": "",
        "name":      "Kevin",
        "email":     "kevin@example.com",
        "venue":     "Satchel's",
        "position":  "Promoter",
        "cash_app":  "$kevin",
        "venmo":     "@kevin",
        "paypal":    "PayPal.me/kevin"
      },
      {
        "photo":     "https://gainesvilletips.org/wp-content/uploads/2020/03/88405c07e157daaa3732b7d6e41ef9c0.jpg",
        "thumbnail": "",
        "name":      "Harry Dresden",
        "venue":     "McAnally's Pub",
        "position":  "Security",
        "cash_app":  "$harry",
        "venmo":     "@harry",
        "paypal":    "PayPal.me/harry"
      },
      {
        "photo":     "https://gainesvilletips.org/wp-content/uploads/2020/03/1200px-SpongeBob_SquarePants_character.svg_.png",
        "thumbnail": "",
        "name":      "Spongebob Squarepants",
        "venue":     "Krusty Krab",
        "position":  "Cook",
        "cash_app":  "$sponge",
        "venmo":     "@sponge",
        "paypal":    "PayPal.me/sponge"
      },
      {
        "photo":     "https://gainesvilletips.org/wp-content/uploads/2020/03/88405c07e157daaa3732b7d6e41ef9c0.jpg",
        "thumbnail": "",
        "name":      "Harry Dresden",
        "venue":     "McAnally's Pub",
        "position":  "Security",
        "cash_app":  "$harry",
        "venmo":     "@harry",
        "paypal":    "PayPal.me/harry"
      }
    ];
  </script>
  <!-- {{ html_comment_end }}
  <script>
    records = {{ records|tojson }};
  </script>
  {{ html_comment }} -->
</html>
